\documentclass[12pt]{extarticle} %twocolumn
\usepackage{geometry}
\geometry{
a4paper,
total={170mm,257mm},
left=20mm,
top=20mm,
headheight=12pt
}

\usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx} % Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
% TeX will automatically convert eps --> pdf in pdflatex		

\usepackage{amssymb,amsmath,amsthm}
\usepackage{commath}
\usepackage{longtable}
\usepackage[hyphens]{url}
\usepackage[dvipsnames]{xcolor}
\usepackage[unicode=true,colorlinks=true,urlcolor=CadetBlue,citecolor=black,linkcolor=black]{hyperref}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
\usepackage[]{authblk}

%SetFonts
% newtxtext+newtxmath
\usepackage{newtxtext} %loads helv for ss, txtt for tt
\usepackage{amsmath}
\usepackage[bigdelims]{newtxmath}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
%SetFonts

% less space before sections 
% \@startsection {NAME}{LEVEL}{INDENT}{BEFORESKIP}{AFTERSKIP}{STYLE} 
%            optional * [ALTHEADING]{HEADING} 
\makeatletter
 \renewcommand\section{\@startsection {section}{1}{\z@}%
     {-2.5ex \@plus -1ex \@minus -.2ex}%
     {1.3ex \@plus.2ex}%
    {\Large\bfseries}}

% Yoav & Lee commands
\newcommand*{\tr}{^\intercal}
\let\vec\mathbf
\newcommand{\matrx}[1]{{\left[ \stackrel{}{#1}\right]}}
\newcommand{\diag}[1]{\mbox{diag}\matrx{#1}}
\newcommand{\goesto}{\rightarrow}
\newcommand{\dspfrac}[2]{\frac{\displaystyle #1}{\displaystyle #2} }
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{remark}{Remark}
\newtheorem{result}{Result}
\renewcommand\qedsymbol{} % no square at end of proof
\newcommand{\cl}{\mathbf{L}}
\newcommand{\cj}{\mathbf{J}}
\newcommand{\ci}{I}

% NatBib
\usepackage[round,colon,authoryear]{natbib}

% Title page
\title{Vertical and oblique transmission with fluctuating transmission}

\author[a]{Yoav Ram}
\author[b]{Uri Liberman}
\author[a]{Marcus W. Feldman}
\affil[a]{Department of Biology, Stanford University, Stanford, CA}
\affil[b]{School of Mathematical Sciences, Tel Aviv University, Israel}

\date{\today}

% Document
\begin{document}
\maketitle

% Abstract
%\begin{abstract}
%\end{abstract}

% Introduction
\section*{Introduction}

Important modes of cultural transmission are vertical (from parent to offspring), horizontal (between peers), and oblique (from non-parental adults to offspring) transmission. 
\citet[ch.~3]{Cavalli-Sforza1981} first introduced models in which a specific trait is transmitted either vertically or obliquely.
Mathematical models of cultural evolution may include one or more modes of cultural transmission and in these models the mode of transmission by individuals is fixed. 
For example, \cite{Aoki2005} and \citet{McElreath2008} focused on competition between individual learning, innate learning, and social learning; \citet{Fogarty2017} compared the effects of different oblique mechanisms (random, success-biased, best-of-k, one-to-many) on the cultural richness and diversity of the population; and \citet{Aoki2012} modeled scenarios in which individual and social learning occur during separate stages in life.

Many of these models included fluctuating selection envisaged as due to environmental changes~\citep[reviewed in][]{Aoki2014}. 
For example, we recently studied a model in which each individual can learn a dichotomous phenotype either from a parent, with probability $\rho$, or from a non-parental adult, with probability $1-\rho$; see \autoref{fig:transmission}.
We found that if selection fluctuates between favoring each of the two phenotypes, but on average favored both phenotypes for similar time periods, then a phenotypic polymorphism may be maintained~\citep{Ram2018}.

There has been much less theory developed for fluctuating transmission.
Nevertheless, if we assume that social learning can be affected by frequency of interactions~\citep{VanSchaik2003}, weather~\citep{Phithakkitnukoon2012}, food availability, population density~\citep{Aureli1997a}, or even political atmosphere, then it is reasonable that the mode and rate of transmission will fluctuate over time. 
For example, it may be the case that during cold seasons offspring are more likely to stay close to their parents and therefore learn vertically, whereas during warm seasons they are more likely to wander and interact with other adults and therefore learn obliquely.

Here, we analyze a model in which individuals learn from their parents with probability $\rho$ (vertical transmission), and from non-parental adults with probability $1-\rho$ (oblique transmission), where $\rho$ fluctuates over time~(\autoref{fig:transmission}).
We find that $\ldots$ %TODO
We suggest that cultural evolution is affected by environmental changes that may affect both selection and transmission, and that further empirical and theoretical studies are required to disentangle these effects.

\begin{figure*}[h]
\centering
\includegraphics[width=0.5\linewidth]{../figures/{transmission}.png}
\caption{
\textbf{Cultural transmission with mixed vertical and oblique transmission.}
When a newborn matures, she will copy her phenotype -- color -- from her mother with probability $\rho$, therefore becoming blue, or from some other female with probability $1-\rho$, in which case her color will depend on the frequency of blue and red adult females.}
\label{fig:transmission}
\end{figure*}

% Model & Results
\section*{Model \& Results}

Consider a very large population whose members are characterized by a single dichotomous cultural trait with phenotypes $A$ and $B$ and fitness values $w_A=1+s$ and $w_B=1$, respectively.
Phenotypes are transmitted vertically with probability $\rho$ or obliquely with probability $1-\rho$~(\autoref{fig:transmission}).
Given $x$ the frequency of phenotype $A$ at the current generation, the frequency of $A$ in the next generation is
\begin{equation} \label{eq:recurrence}
x' = \rho \frac{1+s}{\overline w} x + (1-\rho)x,
\end{equation}
where $\overline w = 1 + xs$ is the population mean fitness.

% Periodic fluctuating transmission
\subsection*{Periodic fluctuating transmission}

Suppose that the vertical transmission rate $\rho$ is fluctuating, such that $\rho = \rho_1$ in odd generations and $\rho = \rho_2$ in even generations.
From \eqref{eq:recurrence}, the recurrence equations for two generations is then
\begin{equation}\begin{aligned} \label{eq:recurrence_two_generations}
x' = \rho_1 \frac{1+s}{\overline w} x + (1-\rho_1)x, \\
x'' = \rho_2 \frac{1+s}{\overline w} x' + (1-\rho_2)x'.
\end{aligned}\end{equation}

First, fixations of $A$ and $B$ ($x^*=0$ and $x^*=1$, respectively) are both equilibria, as they solve $x''=x$.
Second, because $x'/x = 1+\frac{\rho_1 s (1-x)}{1+sx} > 1$ and $x''/x = 1+\frac{\rho_2 s (1-x)}{1+sx} > 1$, the frequency of $A$ increases every generation and $x^*=1$ is globally stable.
Therefore, we find that fluctuations in the mode of transmission ($\rho$) without fluctuations in selection lead to fixation of the favored phenotype without any stable polymorphisms.

% Periodic fluctuating transmission and selection
\subsection*{Periodic fluctuating transmission and selection}

Now suppose that both the vertical transmission rate $\rho$ and the selection coefficient $s$ fluctuate together.

If the environment changes every $k$ generations, so that for the first $k$ generations $A$ is favored and the transmission rate is $\rho_1$ and for the second $k$ generations $B$ is favored and the transmission rate is $\rho_2$.
The change in the frequency of $A$ when either $A$ or $B$ is favored is described by $F_A(x)$ and $F_B(x)$, respectively, where
\begin{equation}\begin{aligned} \label{eq:recurrence_periodic_fluc}
F_A(x) = \rho_1 \frac{1+s}{1+sx} x + (1-\rho_1)x, \\
F_B(x) = \rho_2 \frac{1}{1+s-sx'} x' + (1-\rho_2)x'.
\end{aligned}\end{equation}
Fixations of $A$ ($x^*=1$) and $B$ ($x^*=0$) are locally stable if, respectively,
\begin{equation}\begin{aligned}
\big[F'_A(1) F'_B(1)\big]^k < 1, \\
\big[F'_A(0) F'_B(0)\big]^k < 1. \\
\end{aligned}\end{equation}
and if both of these conditions are not met then there exists a protected polymorphism.
Therefore, for a protected polymorphism we require
\begin{equation}
1 < F'_A(1) F'_B(1) = \Big(1-\rho_1\frac{s}{1+s}\Big)\Big(1+\rho_2 s\Big) 
= 1-\frac{1}{1+s}\big[\rho_2(1+s-\rho_1)-\rho_1\big],
\end{equation}
and
\begin{equation}
1 < F'_A(0) F'_B(0) = \Big(1+\rho_1 s\Big)\Big(1-\rho_2 \frac{s}{1+s}\Big) 
= 1+\frac{s}{1+s}\big[\rho_1(1+s) -\rho_2(1+\rho_1 s)\big],
\end{equation}
which can be summarized as a condition on $\rho_2$
\begin{equation} \label{eq:poly_condition_periodic_fluc}
\frac{\rho_1}{1+s(1-\rho_1)} < \rho_2 < \frac{(1+s)\rho_1}{1+s\rho_1},
\end{equation}
or as a condition on the difference between $\rho_1$ and $\rho_2$
\begin{equation}
-s\rho_2(1-\rho_1) < \rho_2 - \rho_1 < s\rho_1(1-\rho_2).
\end{equation}

\begin{figure*}[hbt]
\centering
\includegraphics[width=0.65\linewidth]{../figures/{rho1_rho2_k=1}.pdf}
\caption{
\textbf{Protected polymorphism with fluctuating transmission and selection.}
The positive root $x^*$ of $G(x)$, see eq.~\ref{eq:xstar_periodic_fluc_k=1}.
Dashed lines represent, from left to right, $\rho_2=\frac{\rho_1}{1+s(1-\rho_1)}$, $\rho_2=\rho_1$, and $\rho_2=\frac{(1+s)\rho_1}{1+s\rho_1}$, see eq.~\ref{eq:poly_condition_periodic_fluc}.
Here, $\rho_1=0.5$, $s=0.1$.}
\label{fig:rho1_rho2_k=1}
\end{figure*}

\autoref{fig:rho1_rho2_k=1} shows the solution for $F_B(F_A(x))=x$ for $k=1$, highlighting the area of the parameter space in which a protected polymorphism exists.
Surprisingly, the stronger selection is, the larger the difference can be that still allows a stable polymorphism.

In the case of $k=1$ we can also find the frequency of $A$ at the protected polymorphism, $x^*$.
Denote $F_B(F_A(x))-x = G(x) \cdot x (1-x) \cdot \gamma$ with
\begin{align} \label{eq:xstar_periodic_fluc_k=1}
G(x) = ax^2+bx+c, \\
\gamma = -\frac{1+xs}{s} \Big( 1 + s + s^2x (1-\rho) +s^2x^2(1-\rho) \Big) > 0, \\
a = s^2 \rho_1 (1-\rho_1) (1 - \rho_2 + \rho_2/\rho_1)) > 0, \\
b = s(1-\rho_1)(2\rho_2 - s\rho_1(1-\rho_2)), \\
c = \rho_2 - \rho_1 - s\rho_1(1-\rho_2),
\end{align} 
and then $x^*$ is a solution of the quadratic $G(x)=0$, given by $x^* = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$.
The condition \eqref{eq:poly_condition_periodic_fluc} guarantees that $x^* \in (0,1)$ and is equivalent to $c<0$.% and $a+b+c>0$.
Therefore, $\sqrt{b^2-4ac} > b$, and if $0<s<1$ (such that $b$ is guaranteed to be positive) then $x^*= \frac{-b+\sqrt{b^2-4ac}}{2a}$ (\autoref{fig:rho1_rho2_k=1}).

%\begin{align}
%G(0) = c > 0  \Leftrightarrow \rho_2 > \frac{\rho_1(1+s)}{1+\rho_1s}, \\
%G'(0) = b > 0 \Leftrightarrow \rho_2 > \frac{\rho_1 s}{2 + \rho_1s}, \\
%G(1) = a + b + c = (1+s)[\rho_2 - \rho_1 + s \rho_2 (1-\rho_1)], \\
%G'(1) = 2a + b = s(1-\rho_1)(2(1+s)\rho_2 + s\rho_1(1-\rho_2)) > 0.
%\end{align} 

In the more general case, phenotype $A$ is favored for $k$ generations and phenotype $B$ for $l$ generations, and the transmission rate follows the same cycle such that $\rho=\rho_1$ when $A$ is favored and $\rho=\rho_2$ when $B$ is favored.
The requirements for a protected polymorphism is now
\begin{equation}\begin{aligned}
1 &< (F'_A(0))^k (F'_B(0))^l = a^k \big(b-\Delta \rho s/(1+s)\big)^l,\\
1 &< (F'_A(1))^k (F'_B(1))^l = b^k (a+\Delta \rho s)^l,
\end{aligned}\end{equation}
where $a=1+\rho_1 s>1$, $b=1-\rho_1\frac{s}{1+s}<1$, and $\Delta \rho = \rho_2 - \rho_1$.
This leads to a condition similar to eq.~20 in~\citet{Ram2018}, but more complex due to the addition of $\Delta \rho$:
\begin{equation} \label{eq:poly_condition_periodic_fluc_k_l}
\frac{-\log{b}}{\log{\big(a+\Delta \rho s\big)}} < 
\frac{l}{k} < 
\frac{\log{a}}{-\log{\big(b-\Delta \rho s/(1+s)\big)}}.
\end{equation}
Note that as $\Delta \rho$ increases, both the RHS and the LHS of \eqref{eq:poly_condition_periodic_fluc_k_l} decrease.
Therefore, increasing the vertical transmission rate specifically when $B$ is favored ($\Delta \rho>0$) decreases the environmental period ratio $l/k$ that permits protected polymorphism; reducing the vertical transmission rate when $B$ is favored ($\Delta \rho<0$) will have the opposite effect, increasing the ratio $l/k$ that permits a protected polymorphism.

% TODO plot \Delta \rho vs s and show the boundaries

% Randomly fluctuating transmission and selection
\subsection*{Randomly fluctuating transmission and selection}

We now allow both transmission and selection to fluctuate randomly.
Rewrite eq.~28 from \citet{Ram2018} so that $\rho$ is also a random variable
\begin{equation}
x_t = x_t \frac{1 + \rho_t s_t + x_t (1 - \rho_t) s_t}{1 + x_t s_t},
\end{equation}
where $s_t$ are i.i.d (independent and identically distributed), $Pr(-1+C<s_t<D)=1$ for some positive $C$ and $D$, $\rho_t$ are i.i.d, and  $0<\rho_t<1$ ($t=0,1,2,\ldots$).
Therefore, $z_t = \rho_t s_t$  are independent and identically distributed and $P(-1+C < z_t < D$ and from Result~6 and 7 of \citet{Ram2018} we have:
\begin{itemize}
\item Suppose $E[log(1+\rho_t s_t)]>0$. Then $x^*=0$ is not stochastically locally stable and in fact $P(lim_{t \to \infty} x_t=0) = 0$, i.e., fixation of $B$ almost surely does not occur.
\item Suppose $E[log(1+\rho_t s_t)]<0$. Then $x^*=0$ is stochastically locally stable and 
\item Similarly, if $E[log(1-\rho_t s_t/(1+s_t)]<0$, then $x^*=1$ is stochastically locally stable, and if $E[log(1-\rho_t s_t/(1+s_t))]>0$, then fixation of $A$ almost surely does not occur.
\item In particular, if $E[\rho_t s_t] = cov(\rho_t, s_t) + E[\rho_t] E[s_t] \le 0$ then $x^*=0$ is stochastically locally stable, and similarly if $E[-\rho_t s_t/(1+s_t)] = cov(\rho_t, -s_t/(1+s_t)) - E[\rho_t] E[s_t/(1+s_t)] \le 0$ then $x^*=1$ is stochastically locally stable.
\item Note that it is not possible that both $E[log(1+\rho_t s_t)]$ and $E[log(1-\rho_t s_t/(1+s_t)]$ are negative, as their sum is positive
\begin{multline}
E[log(1+\rho_t s_t)] + E[log(1-\rho_t s_t/(1+s_t)] = \\
E[log(1+\rho_t s_t) + log(1-\rho_t s_t/(1+s_t)]= \\
E[log\big((1+\rho_t s_t)(1-\rho_t s_t/(1+s_t)\big)]= \\
E[log\big( 1+\rho_t(1-\rho_t)(s_t^2)/(1+s_t) \big)] > 0,
\end{multline}
and therefore it is not possible that both fixations are stochastically locally stable.
\end{itemize}

We will now present a number of examples.
First, if $s_t$ and $\rho_t$ are independent ($cov(s_t, \rho_t)$) and $s_t$ is symmetric around zero, then $E[\rho_t s_t]=0$ and $E[-\rho_t s_t/(1+s_t)]>0$ (because $E[s_t/(1+s_t)] < E[s_t]$).
Therefore, fixation of $B$ is stochastically locally stable and fixation of $A$ almost surely does not occur.
For example, let $s_t \sim U(-1, 1)$ and $\rho_t \sim U(0,1)$ independently (in particular, $cov(\rho_t, s_t)=0$), then $E[log(1+\rho_t s_t)]\approx -0.07315$ and $E[log(1-\rho_t s_t/(1+s_t))]\approx 0.2337$.
However, note that symmetry of $s_t$ around zero provides an advantage to phenotype $B$ -- using Jensen's inequality, $E[w_A/w_B] = E[1+s_t] = 1 \le E[1/(1+s_t)] = E[w_B/w_A]$.
Therefore, if we take $w_{A,t}, w_{B,t} \sim U(0,1)$ independently, and $s_t=(w_A-w_B)/w_B$, then neither $A$ nor $B$ has an advantage, on average (i.e. $E[w_A/w_B]=E[w_B/w_A]$, see \autoref{fig:beta}A), and both $E[\rho_t s_t]$ and $E[-\rho_t s_t/(1+s_t)]$ are positive, so that both fixations are not stochastically locally stable.

Second, if $s_t$ and $\rho_t$ are not independent, we can get fixation. Let $\rho_t \sim \beta(1+s, 1)$, where $s_t=(w_A-w_B)/w_B$ and $w_A, w_B \sim U(0,1)$, such that the covariance of $s_t$ and $\rho_t$ is positive ($cov(s_t, \rho_t) \approx 4$); that is, vertical transmission is more likely when $A$ is favored (i.e. $s_t>0$) and oblique transmission is more  likely when $B$ is favored (i.e. $s_t<0$; \autoref{fig:beta}).
Then $E[log(1+\rho_t s_t)] >0$ and $B$ almost surely doesn't fix, and $E[log(1-\rho_t s_t / (1+s_t)] < 0$, so fixation of $A$ is stochastically locally stable.
The opposite occurs if $\rho_t \sim \beta(1, 1+s)$ and the covariance of $s_t$ and $\rho_t$ is negative ($cov(s_t, \rho_t) \approx -4$). In that case, fixation of $B$ is stochastically locally stable and $A$ almost surely doesn't fix.

\begin{figure*}[hbt]
\centering
\includegraphics[width=\linewidth]{../figures/{beta}.png}
\caption{
\textbf{Covariance of selection and transmission.}
\textbf{(A)} Histogram of $w_A/w_B$ where $w_A$ and $w_B$ are identically and independently distributed uniform random variables $U(0,1)$.
\textbf{(B)} Histogram of $s_t = (w_A-w_B)/w_B$.
\textbf{(C)} Histogram of $\rho_t \sim Beta(1+s_t, 1)$.
\textbf{(C)} The joint distribution of $\rho_t$ and $s_t$ demonstrates a positive correlation $cov(s_t, \rho_t)>0$.
}
\label{fig:beta}
\end{figure*}

Third, it is also possible that both fixations are not stochastically locally stable even if $s_t$ and $\rho_t$ covary, but, as in the case of periodic fluctuations, this can only occur if the fluctuations in $\rho_t$ are small.
For example, \autoref{fig:rho1_rho2_stoch_p} shows the expected outcome when $s_t=s$ and $\rho_t=\rho_1$ with probability $p=0.505$ and $s_t=-s$ and $\rho_t=\rho_2$ with probability $1-p=0.495$.
The blue and red areas denote expected fixation of $A$ and $B$, respectively (i.e. stochastic local stability) and the white area shows expected polymorphism (neither fixation is stochastically locally stable). 

\begin{figure*}[hbt]
\centering
\includegraphics[width=0.75\linewidth]{../figures/{rho1_rho2_stoch_p}.pdf}
\caption{
\textbf{Stochastic local stability.}
Here, $s_t=s$ and $\rho_t=\rho_1$ with probability $p=0.505$ and $s_t=-s$ and $\rho_t=\rho_2$ with probability $1-p=0.495$, with $s=0.05$ and $p=0.505$, a combination that allows a stochastic polymorphism with a fixed vertical transmission rate $\rho=0.1$ in~\citet[Fig.~2]{Ram2018}.}
\label{fig:rho1_rho2_stoch_p}
\end{figure*}

% Finite population size
\subsection*{Finite population size}

To include the effect of random drift due to finite population size in the above deterministic model, we follow \citet{Ram2018} and develop a diffusion equation approximation.
In~\citet{Ram2018} only selection fluctuated via $s_t$, but here we also transmission to fluctuate via $\rho_t$. 

We find a result similar to Result 11 from~\citet{Ram2018}:
The mean $\mu(x)$ and variance $\sigma^2(x)$ of the change in the frequency of $A$ in one generation for the diffusion approximation in the case of a cycling environment $AkBl$, where $k+l=n$, are
\begin{equation}
\mu(x) = S_n x(1-x), \quad \text{and} \quad \sigma^2(x) = n x (1-x)
\end{equation}
where $S_n = \sum_{t=1}^{n}{\rho_t s_t}$, which is a weighted average of the selection coefficients in favor of phenotype $A$, weighted by the vertical transmission rate.


% Discussion
\section*{Discussion}

Models of cultural transmission mostly assume a fixed relative rate at which different modes of transmission -- vertical, horizontal, or oblique -- occur.
Here we explored a model in which the relative rate of vertical and oblique transmission fluctuates over time, either periodically or randomly. 
Comparing our results with previous results from a similar model with a fixed rate~\citep{Ram2018}, we find that transmission fluctuations constrain the maintenance of phenotypic polymorphism.
%Specifically, if fluctuations are not small then a single phenotype is likely to fix in the population~(\autoref{eq:poly_condition_periodic_fluc}, \autoref{fig:rho1_rho2_k=1}, \autoref{fig:rho1_rho2_stoch_p}), and 

% Face book rural internet
% National service - Israel, Singapore
% Immigrtion - draught
% Opening schools, universities
% sending students abroad, bringing experts from abroad
% foreign labor
% refugees
% hunter-gatherers/chimps increase habitat in years with less food production
% religion - dark ages etc.

% Acknowledgements
%{\small
%\section*{Acknowledgements}
%
%This work was supported in part by 
%the Stanford Center for Computational, Evolutionary and Human Genomics, 
%and the Morrison Institute for Population and Resources Studies, Stanford University.
%}

\bibliographystyle{agsm}
\bibliography{/Users/yoavram/Documents/library}
%\bibliography{fluctuating_oblique}

\end{document}  